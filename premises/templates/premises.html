{% load static %}
<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" id="metaViewport">
    <title>Title</title>
    <meta name="twitter:title" content="Title">
    <meta property="og:title" content="Title">
    <meta name="description" content="">
    <meta property="og:description" content="">
    <meta property="og:image" content="img/default.png">
    <meta property="vk:image" content="img/default.png">
    <meta name="twitter:image" content="img/default.png">
    <link rel="shortcut icon" href="img/favicon/favicon.ico" type="image/x-icon">
    <meta name="theme-color">
    <meta name="msapplication-navbutton-color">
    <meta name="apple-mobile-web-app-status-bar-style">

    <link rel="stylesheet" href="{% static 'css/reset.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/responsive.css' %}">
    <link rel="stylesheet" href="{% static 'css/categories/premises.css' %}">
    <link rel="stylesheet" href="{% static 'css/ion.rangeSlider.css' %}">
    <link rel="stylesheet" href="{% static 'css/bootstrap.css' %}">


    <script src="https://kit.fontawesome.com/6c1cf59610.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="{% static 'js/ion.rangeSlider.min.js' %}"></script>
</head>

<body>

<div class="container-sm container-md container-lg container-xl container-xxl">

{% include 'includes/header.html' %}

<section id="insert-panel">

    <h3>
        Только <span>самые комфортные помещения города с адекватной ценой.</span><br>
        Мы <span>все проверили сами и подготовили для вас видеообзоры.</span>
    </h3>

    <div class="list-button">
        <i class="fas fa-list-ul"></i>
        <span>списки</span>
    </div>

    <a href="#">
        <h6>
            Посмотреть все
            варианты на
            карте
        </h6>
        <i class="fas fa-map-marker-alt"></i>
    </a>

</section>

<section id="main">

    {% include 'includes/sidebars/sidebar-premises.html' %}

    <div class="content">

        <div class="content-top-panel">
            <div class="notification">
                <h4>Более 100 проверенных мест для праздника - выбирай на свой вкус</h4>
            </div>
            <div class="sorting">
                <select id="sorting">
                    <option value="-views">По популярности</option>
                    <option value="-raiting">По рейтингу</option>
                    <option value="-price">Сначала дорогие</option>
                    <option value="price">Сначала дешёвые</option>
                </select>
            </div>
        </div>

        <div class="products">
            {% for premise in premises reversed %}
            {% if forloop.counter|divisibleby:"3" %}
            <div class="advertisement-one">

                <i class="fas fa-headset"></i>

                <h3>Трудно выбрать? Оставьте заявку, мы подберём подходящие варианты</h3>

                <div class="block-button">
                    <button>Оставить заявку</button>
                    <span>Консьерж-сервис бесплатно</span>
                </div>

            </div>
            {% endif %}
            <div class="premises-card">

                <div class="wrap-thumbnail">

                    <div class="discount">
                        <h4>Подарок</h4>
                    </div>

                    <div class="tap">
                        <i class="fas fa-hand-pointer"></i>
                    </div>

                    <div class="camera">
                        <i class="fas fa-video"></i>
                    </div>

                    <video controls="false" src="/static/video/video.mp4"></video>

                    <div class="blackout"></div>

                </div>

                <div class="premises-card-content">
                    <a href="/product/premise/{{premise.slug}}" style="width: 100%; height: 100%;">f</a>
                </div>

            </div>
            {% endfor %}

        </div>
        {% include 'includes/pagination.html' with product_count=premises_count%}

    </div>

</section>

<section id="more">

    <div class="more-container">

        <div class="more-box chief">
            <h3>
                Сохраняем ваше время и дарим скидки
            </h3>
        </div>

        <div class="more-box">
            <span>Более 100 вариантов</span>
            <h3><a href="#">Праздник "под ключ"</a></h3>
            <span>Выбирайте, чем порадовать именинника</span>
        </div>

        <div class="more-box chief">
            <h3>
                Праздник на любой
                вкус и бюджет
            </h3>
        </div>

        <div class="more-box">
            <span>Вау-эффект обеспечен</span>
            <h3><a href="#">Конструктор праздника</a></h3>
            <span>Не ограничивайте фантазию</span>
        </div>
    </div>

</section>

<section id="choose">

    <h2>
        <span>Вот что мы ещё подготовили для вашего праздника</span>
    </h2>

    <div class="choose-container">

        <div class="image-block one" style="background: url({% static 'images/slide1.png' %});background-size: cover;background-position: center;">
            <h3>Вкусная и полезная еда с доставкой</h3>
        </div>
        <div class="image-block two" style="background: url({% static 'images/slide1.png' %});background-size: cover;background-position: center;">
            <h3>Самые смешные аниматоры</h3>
        </div>
        <div class="image-block three" style="background: url({% static 'images/slide1.png' %});background-size: cover;background-position: center;">
            <h3>Захватывающие квесты</h3>
        </div>
        <div class="image-block four" style="background: url({% static 'images/slide1.png' %});background-size: cover;background-position: center;">
            <h3>Стильные и необычные декорации</h3>
        </div>
        <div class="image-block five" style="background: url({% static 'images/slide1.png' %});background-size: cover;background-position: center;">
            <h3>Видеографы, которые сохранят атмосферу счастья</h3>
        </div>

    </div>
</section>

</div>

<script>
    function pagination_create(count, active) {
        if (count >= 20) {
            let pagination = '';
            let numbers = (Number(count) + 20) / 20;
            if (active === 1) {
                pagination = '<button class="prev" style="display: none">Назад</button><ul><li class="prev" style="display: none"><</li>';
            } else {
                pagination = '<button class="prev">Назад</button><ul><li class="prev"><</li>';
            }
            for (let i = 1; i < numbers; i++) {
                pagination += '<li>' + i + '</li>';
            }
            if (active === Math.floor(numbers)) {
                pagination += '<li style="display: none">...</li><li class="next" style="display: none">></li></ul><button class="next" style="display: none">Вперёд</button>';
            } else {
                pagination += '<li>...</li><li class="next">></li></ul><button class="next">Вперёд</button>';
            }
            $('.pagination').html(pagination);
        }
    }
    $(document).ready(function() {
        var filters = '';
        var order_by = '';
        var data = '';
        var post_count = $('.w-all').text();
        pagination_create(post_count, 1);

        $(".rental_price").ionRangeSlider({
            skin: "round",
            type: "single",
            grid: true,
            min: 1600,
            max: 3200,
            from: 2400,
            step: 1,
            drag_interval: true,
            from_shadow: true,
            grid_num: 1,
            hide_min_max: true,
            onFinish: function(data) {
                if (filters == '') {
                    filters += 'price=' + data.from;
                } else {
                    filters +=  ',price=' + data.from;
                }
                if (order_by === '') {
                    data = {model: 'Premises', filters: filters, csrfmiddlewaretoken: '{{ csrf_token }}'};
                } else {
                    data = {model: 'Premises', order_by: order_by, filters: filters, csrfmiddlewaretoken: '{{ csrf_token }}'};
                }
                $.ajax({
                    url: '/ajax/sidebar-filters/',
                    data: data,
                    type: 'POST',
                    dataType: 'json',
                    success: function(data){
                        $('#main .products').html(data.objects);
                    }
                });
                return false;
            },
        });
        $(".square").ionRangeSlider({
            skin: "round",
            type: "single",
            grid: true,
            min: 30,
            max: 225,
            from: 123,
            step: 1,
            drag_interval: true,
            from_shadow: true,
            grid_num: 1,
            hide_min_max: true,
            onFinish: function(data) {
                if (filters === '') {
                    filters += 'square=' + data.from;
                } else {
                    filters +=  ',square=' + data.from;
                }
                if (order_by === '') {
                    data = {model: 'Premises', filters: filters, csrfmiddlewaretoken: '{{ csrf_token }}'};
                } else {
                    data = {model: 'Premises', order_by: order_by, filters: filters, csrfmiddlewaretoken: '{{ csrf_token }}'};
                }
                $.ajax({
                    url: '/ajax/sidebar-filters/',
                    data: data,
                    type: 'POST',
                    dataType: 'json',
                    success: function(data){
                        $('#main .products').html(data.objects);
                    }
                });
                return false;
            },
        });

        $('.input-block').on('change', 'input', function () {
            if ($(this).attr('type') === 'text' || $(this).attr('type') === 'date') {
                var name = $(this).attr('data-name');
                var val = $(this).val();
            } else if ($(this).attr('type') === 'checkbox'){
                if ($(this).prop('checked') === true) {
                    var name = $(this).attr('data-name');
                    var val = $(this).next().text();
                } else {
                    var name = $(this).attr('data-name');
                    var val = '';
                }
            } else {
                return;
            }

            if (filters === '') {
                filters +=  name + '=' + val;
            } else {
                filters +=  ',' + name + '=' + val;
            }
            if (order_by === '') {
                data = {model: 'Premises', filters: filters, csrfmiddlewaretoken: '{{ csrf_token }}'};
            } else {
                data = {model: 'Premises', order_by: order_by, filters: filters, csrfmiddlewaretoken: '{{ csrf_token }}'};
            }
            $.ajax({
                url: '/ajax/sidebar-filters/',
                data: data,
                type: 'POST',
                dataType: 'json',
                success: function(data){
                    $('#main .products').html(data.objects);
                }
            });
            return false;
        });
        $('.input-block').on('change', 'select', function () {
            let name = $(this).attr('data-name');
            let val = $(this).val();

            if (filters == '') {
                filters +=  name + '=' + val;
            } else {
                filters +=  ',' + name + '=' + val;
            }
            if (order_by === '') {
                data = {model: 'Premises', filters: filters, csrfmiddlewaretoken: '{{ csrf_token }}'};
            } else {
                data = {model: 'Premises', order_by: order_by, filters: filters, csrfmiddlewaretoken: '{{ csrf_token }}'};
            }
            $.ajax({
                url: '/ajax/sidebar-filters/',
                data: data,
                type: 'POST',
                dataType: 'json',
                success: function(data){
                    $('#main .products').html(data.objects);
                }
            });
            return false;
        });

        $(document).on('click', '.tap', function () {
            $(this).next().next().get(0).play();
            $(this).fadeOut();
        });
        $(document).on('click', 'video', function () {
            $(this).prev().prev().fadeIn();
        });

        $('#sorting').on('change', function () {
            order_by = $(this).val();
            if (filters === '') {
                data = {model: 'Premises', order_by: order_by, csrfmiddlewaretoken: '{{ csrf_token }}'};
            } else {
                data = {model: 'Premises', order_by: order_by, filters: filters, csrfmiddlewaretoken: '{{ csrf_token }}'};
            }
            $.ajax({
                url: '/ajax/sidebar-filters/',
                data: data,
                type: 'POST',
                dataType: 'json',
                success: function(data){
                    $('#main .products').html(data.objects);
                }
            });
            return false;
        });
    });
</script>
</body>




